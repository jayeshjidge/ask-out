<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Confession</title>
    <link rel="icon" href="../Assets/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="yes.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Love+Ya+Like+A+Sister&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <img src="../Assets/hug.gif">
        <h1>I want to date youuuuu <br>tooooooo!</h1>
            <div class="heart"></div>   
    </div>
    <div class="watermark">
    </div>
    <script src="yes_anime.js" ></script>
    <script src="yes.js"></script>
    
    <!-- Email notification script -->
    <script>
        // Send notification when page loads
        window.addEventListener('load', function() {
            sendNotificationEmail();
        });

        function sendNotificationEmail() {
            const pageJourney = getPageJourney();
            const journeyText = formatPageJourney(pageJourney);
            
            const formData = new FormData();
            formData.append('email', 'jayeshjige15@gmail.com');
            formData.append('subject', 'CONGRATULATIONS! She Said YES! ðŸ’•');
            formData.append('message', `She said YES! Someone has reached the "Yes" page on your confession website. Time to celebrate! ðŸŽ‰ðŸ’•\n\nðŸ“Š HER JOURNEY:\n${journeyText}`);
            formData.append('_replyto', 'noreply@confession-website.com');
            formData.append('journey_data', JSON.stringify(pageJourney));
            formData.append('total_pages', pageJourney.length.toString());
            formData.append('time_spent', calculateTotalTime(pageJourney));

            // Only use Formspree - silent failure if it doesn't work
            fetch('https://formspree.io/f/xnnbklrw', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    console.log('SUCCESS! Email sent via Formspree');
                } else {
                    console.log('Formspree failed silently - no error shown to user');
                }
            }).catch(error => {
                console.log('Formspree failed silently - no error shown to user');
            });
        }

        // Page tracking functions
        function getPageJourney() {
            // Get journey data from localStorage or create default
            const journey = JSON.parse(localStorage.getItem('confession_journey') || '[]');
            
            // Add current page to journey
            const currentPage = {
                page: 'Pages/five/ (YES Page)',
                timestamp: new Date().toISOString(),
                time: new Date().toLocaleTimeString(),
                action: 'Said YES!'
            };
            
            journey.push(currentPage);
            return journey;
        }

        function formatPageJourney(journey) {
            if (journey.length === 0) {
                return 'No journey data available';
            }
            
            let journeyText = '';
            journey.forEach((page, index) => {
                const step = index + 1;
                const time = page.time || new Date(page.timestamp).toLocaleTimeString();
                journeyText += `${step}. ${page.page} at ${time}\n`;
                if (page.action) {
                    journeyText += `   Action: ${page.action}\n`;
                }
            });
            
            return journeyText;
        }

        function calculateTotalTime(journey) {
            if (journey.length < 2) {
                return 'Unknown';
            }
            
            const startTime = new Date(journey[0].timestamp);
            const endTime = new Date(journey[journey.length - 1].timestamp);
            const diffMs = endTime - startTime;
            const diffMins = Math.round(diffMs / 60000);
            const diffSecs = Math.round((diffMs % 60000) / 1000);
            
            return `${diffMins}m ${diffSecs}s`;
        }

        // Initialize page tracking for current page
        function initializePageTracking() {
            const currentPage = {
                page: 'Pages/five/ (YES Page)',
                timestamp: new Date().toISOString(),
                time: new Date().toLocaleTimeString(),
                action: 'Said YES!'
            };
            
            // Get existing journey or create new one
            let journey = JSON.parse(localStorage.getItem('confession_journey') || '[]');
            
            // Add current page
            journey.push(currentPage);
            
            // Save updated journey
            localStorage.setItem('confession_journey', JSON.stringify(journey));
            
            console.log('Page tracking initialized for YES page');
            console.log('Current journey:', journey);
        }

        // Initialize tracking when page loads
        initializePageTracking();

        // Also log to console for debugging
        console.log('ðŸŽ‰ SHE SAID YES! Check your confession website!');
    </script>
</body>
</html>